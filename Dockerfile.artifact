FROM java:8-jre-alpine
COPY target/universal/policy-enforcement-engine-1.0-SNAPSHOT.tgz app/policy-enforcement-engine-1.0-SNAPSHOT.tgz
EXPOSE 9000
RUN /bin/sh -c "apk add --no-cache bash" 
RUN apk --update add tar
RUN ["tar", "xvzf", "app/policy-enforcement-engine-1.0-SNAPSHOT.tgz", "-C", "app"]
COPY applicationEngine.conf /app/policy-enforcement-engine-1.0-SNAPSHOT/conf/applicationEngine.conf
COPY connections-DITAS.yml /app/policy-enforcement-engine-1.0-SNAPSHOT/conf/connections-DITAS.yml
COPY demo-dpcm-DITAS.yml /app/policy-enforcement-engine-1.0-SNAPSHOT/conf/demo-dpcm-DITAS.yml
RUN  rm -rf /app/policy-enforcement-engine-1.0-SNAPSHOT/lib/dummy_demosparksql_2.11-0.1.jar
COPY demo-sparksql-1.0-SNAPSHOT-jar-with-dependencies.jar /app/policy-enforcement-engine-1.0-SNAPSHOT/lib/demo-sparksql-1.0-SNAPSHOT-jar-with-dependencies.jar 
ENTRYPOINT ["app/policy-enforcement-engine-1.0-SNAPSHOT/bin/policy-enforcement-engine",  "-Dplay.http.secret.key='wspl4r'", "-Dconfig.file=/app/policy-enforcement-engine-1.0-SNAPSHOT/conf/applicationEngine.conf"]

